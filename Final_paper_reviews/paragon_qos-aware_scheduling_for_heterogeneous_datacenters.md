###Paragon: QoS-Aware Scheduling for Heterogeneous Datacenters

*Delimitrou C, Kozyrakis C. Paragon: QoS-aware scheduling for heterogeneous datacenters[J]. ACM SIGARCH Computer Architecture News, 2013, 41(1): 77-88.*

<http://web.stanford.edu/~cdel/2013.asplos.paragon.pdf>

本文为数据中心设计实现了Paragon调度器，优化的核心目标是：任务性能（用户的目标）和资源利用效率（数据中心管理员的目标）。也就是说，在不破坏任务QoS的前提下，尽可能多部署任务（充分混布），且使任务尽快完成（增大吞吐）。

为了实现这两个目标，对于每个任务做调度时，研究者解决的两个核心问题：“这个任务放在哪种硬件配置上性能最好”，以及“这个任务和哪些任务混合部署，彼此互相间的干扰最小”。

该调度器能够在线运行，计算开销小，且其一大特色是，对新到来的任务不需要有丰富的先验知识（了解该任务的一系列特征），也不需要对任务进行过于详细的测量以刻划任务的特征。Paragon的最大特点是用collaborative filting（协同过滤）的方法，基于调度器历史上见过的任务历史，来对新到来的任务进行快速分类（这个任务和历史上哪些任务特性相似）。

协同过滤的方法在推荐系统中普遍应用。Paragon借鉴了协同过滤中奇异值分解的方法来解决任务特性刻划的问题，非常有趣。

假设豆瓣儿上有m个网友，n部电影，每个网友对n部电影中的全部或部分打了个分数，则网友对电影的喜好特征可以被m*n的矩阵A所刻划。A可能很稀疏，可能有许多缺失的元素。

奇异值分解将A拆分成矩阵U V 和对角阵X，即A = UXV* （V*为V转置）。
矩阵的内在含义：X的维度r是A的秩，体现了网友对电影的喜爱这件事中的一些内在相似特征（similarity concept），比如“是动作片”，比如“喜欢看指环王1的大都也喜欢看指环王2”。U矩阵刻画了每个用户和各个similarity concept的关联程度。而V矩阵的刻画了每个电影和各个similarity的关联程度。而X矩阵每个对角元刻画了每个similarity concept的置信度，可靠性，显著性。
对于A矩阵缺失元素的问题，论文说用QR-reconstruction的方法重构。

获得了矩阵X重构的R后，借助R可以来做基于相似性的推荐。

Paragon用这个方法对每个任务做两类分析。

- 任务（网友）在每种硬件配置（服务器选型）（电影）的性能表现（喜爱程度）。
- 任务对每种资源（cpu, memory, LLC等）的敏感程度，以及任务对每种资源造成的干扰程度。

分析方法为采两个样本测量。例如新来任务j，随机采两种服务器选型，让j在上面跑，采集'useful' IPS指标来衡量性能，借此来刻划任务的特征。

文章对两类分析中分类的准确性进行了分析。

Paragon对于每一个新到来的任务，基于上面两种分析，选择合适的目标机器。一般采用贪心算法Greedy Server Selection，足够了。但对于更大规模的数据中心，一是解的最优性没有保障，而是计算开销变大。研究者提出了一个Statistical Framework，基于hash算法的随机性来对目标机器进行采样过滤，再做调度决策。

论文对于Paragon的一些问题进行了讨论，例如1分钟的测量时间有偶然性（任务在不同阶段表现不一样），可以用动态迁移等策略（rescheduling）；我最关心的是Paragon没有考虑负载间的依赖关系（搜索任务的多层执行），没有细粒度优化对于数据共享型任务的放置，没有考虑延迟敏感型任务和吞吐型任务的区分，没有优先级层面上的区分。研究者说future work再解决这个问题吧。

实验非常充分，大集群，小集群，高负载低负载全部都做了，EC2上1000个，Azure上500个机器，覆盖14个、8个不同的型号配置，任务类型也很多样化（178种应用），每项试验对比了P调度器，和NH（no heterogeneity-aware），NI(no interference-aware)调度器，加上baseline，4个调度器的实验结果。这些实验感觉需要很长的时间来设计、实现。

实验指标方面，主要用的是任务相对于在最佳平台上单独运行的性能的加速比。所以应该是任务完成时间。但这个跟在线任务的延迟还不是一回事。这篇文章并不是针对延迟敏感型任务做的分析。

不同实验环境下结果一致性体现调度器的robustness。

实验内容关注的指标主要是QoS情况，任务性能比较，资源分配（over-provision）合理性（利用率提升的程度）。
